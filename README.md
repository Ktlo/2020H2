Лабораторная №2 по Технологиям компьютерных сетей
=====================================================

DNS сервер
-----------------------------------------------------

### Использование

    net-lab2-server [опции] [-|[[@]конфигурация]]

Опции:
- **--bind=ADDRESS** адрес для бинлинга (по умолчанию udp://localhost:53)
- **--verb=VARIANT** уровень логирования (варианты: none|fatal|error|warning|info|verbose|debug) (по умолчанию: info)
- **--dump, -D** оставлять содержимое UDP пакетов в рабочей деректории в виде отдельных файлов
- **--debug, -d** установить уровень debug уровень у лога

Единственный аргумент здесь -- путь до файла настроек сервера (по умолчанию `zones.yml`).

Файл настроек -- это YAML файл, в котором находятся записи, которые будет выдавать сервер.

```yaml
# Это коренной домен, любая запись, не начинающаяся с символа $ -- это доменное имя
# YAML Map используется для обозначения зоны

# Запись, оканчивающаяся символом '.' возвращает уровень доменного имени к корню.

# С помощью этой переменной можно задать ttl всех записей этого уровня и ниже.
# Переопределение этой переменной изменит значение также для этого уровня и ниже.
$ttl: 3322

# То же самое что и в $ttl, но для установки класса записи
$class: IN

# Сервер, которому следует передать запрос, если запрос попал в эту зону (корень
# в данном случае)
$forward:
- 10.1.0.1:53
# По не вышло сделать запросы последовательно через коренные сервера, с сожалению
- 8.8.8.8
- 8.8.4.4

finger-food.ru.:
    $ttl: 4444
    : !MX 5 mx

# Пустая зона
147.234.201.88.in-addr.arpa.: ~

handtruth.com:
    # Разрешить запросы в эту зону с указанных адресов
    $allow:
    - localhost

    # Запретить запросы с указанных адресов
    #$deny:
    #- some.example.com
    #- 123.123.123.123

    # Пустой ключ означает этот поддомен, в данном случае "handtruth.com"
    : !AAAA # Можно определить несколько одного типа с помощью списка YAML
    - 2002:58c9:ea93:0:0:0:0:0
    - 0:0:0:0:0:FFFF:58C9:EA93
    : !A 88.201.234.147
    mc: !CNAME
    vanilla.mc: !CNAME mc # Алиас ссылающийся на алиас
    : !MX 10 mx.yandex.net.
    : !MX # Каждый тип записи имеет 2 способа задавать значения
        priority: 22
        exchange: mx
    mx: !CNAME
    : !NS
    - ns1
    - ns2
    - ns3
    ns1: !CNAME # Пустое значение -- этот же домен
    ns2: !A
        address: 93.100.1.66
    ns3: !A 94.19.255.12
    # Точка в конце имени позволяет вернуться к корню
    147.234.201.88.in-addr.arpa.: !PTR # При этом пустое значение -- этот же домен
    : !SOA # Данная запись делает сервер авторитетным для этой зоны
        origin: ns1
        admin: admin
        serial: 20060205
        refresh: 3600
        retry: 900
        expire: 3600000
        minimum: 3600
    _mcsman._tcp: !SRV 10 30 1337 mc
    _mcsftp._udp: !SRV
        priority: 10
        weight: 30
        port: 9645
        target: ftp.mc
    # Несколько TXT записей
    text: !TXT [ Several, TXT, records ]
    texts: !TXT # TXT запись с несколькими значениями
        text: [ One, TXT, record, with, multiple, values ]
    dev: # Поддомен не авторитетный
        : !A 23.45.0.1
```

### Образ Docker

    docker run -d --name my-dns -v `pwd`/zones.yml:/zones.yml ktlo/net-lab2:dns

NTP Клиент
-----------------------------------------------------

### Использование

    rlwrap lab1-chat-client [хост] [порт] [начальная временная метка]

NTP оказался намного сложнее, чем я изначально подумал, но я сделал минимум. Время он спросить может.

### Образ Docker

    docker run -t --rm -v ktlo/net-lab2:ntp

Как построить?
-----------------------------------------------------

### Из исходного кода

Для сборки нам понадобятся:

```sh
apt install -y cmake build-essential git python3 python3-pip ninja-build \
  && python3 -m pip install --user meson
```

Сборка осуществляется с помощью [Meson](https://mesonbuild.com). Для сборки нужно выполнить следующую команду.

```sh
meson -Dbuildtype=release -Doptimization=3 build && cd build && ninja
```

Для установки в операционную систему можно выполнить:

    ninja install

Чтобы удалить:

    ninja uninstall

### Сборка образа Docker

    docker build -t net-lab2-<?> -f Dockerfile.<?> .

Особенности реализации
-----------------------------------------------------

Программа совместима только с Linux операционными системами.

### NTP Клиент

Почти ничего не может. Вообще по протоколу он должен опрашивать несколько серверов, иметь возможность авторизации, собирать статистику, а также выполнять особые действия при некоторых управляющих кодах. По сути этот клиент только демонстрирует один запрос и вычисление временного смещения.
