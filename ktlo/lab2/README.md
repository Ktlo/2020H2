Лабораторная №2 по Технологиям компьютерных сетей
=====================================================

DNS сервер
-----------------------------------------------------

### Использование

    net-lab2-server [[@]конфигурация]

Единственный аргумент здесь -- путь до файла настроек сервера.

Файл настроек -- это YAML файл, в котором находятся записи, которые будет выдавать сервер.

```yaml
$dns: # Настройки сервера
    port: domain # UDP порт сервера
    address: 0.0.0.0 # Адрес для биндинга
    verb: info # Уровень логирования (debug, verbose, info, warning, error)
    dump: false # Оставлять содержимое пакетов в файлах в рабочей директории (для отладки)

# Это коренной домен, любая запись, не начинающаяся с символа $ -- это доменное имя
# YAML Map можно исмользовать для удобного вормирования записей,
# чтобы не приписывать всё имя.

# Запись, оканчивающаяся символом '.' возвращает уровень доменного имени к корню.

# С помощью этой переменной можно задать ttl всех записей этого уровня и ниже.
# Переопределение этой переменной изменит значение также для этого уровня и ниже.
$ttl: 3322

# То же самое что и в $ttl, но для установки класса записи
$class: IN

handtruth.com:
    # Пустой ключ означает этот поддомен, в данном случае "handtruth.com"
    : !AAAA # Можно определить несколько одного типа с помощью списка YAML
    - 2002:58c9:ea93:0:0:0:0:0
    - 0:0:0:0:0:FFFF:58C9:EA93
    : !A 88.201.234.147
    mc: !CNAME
    : !MX 10 mx.yandex.net.
    : !MX # Каждый тип записи имеет 2 способа задавать значения
        priority: 22
        exchange: mx
    mx: !CNAME
    : !NS
    - ns1
    - ns2
    - ns3
    ns1: !CNAME # Пустое значение -- этот же домен
    ns2: !A
        address: 93.100.1.66
    ns3: !A 94.19.255.12
    # Точка в конце имени позволяет вернуться к корню
    147.234.201.88.in-addr.arpa.: !PTR # При этом пустое значение -- этот же домен
    : !SOA
        origin: ns1
        admin: admin
        serial: 20060205
        refresh: 3600
        retry: 900
        expire: 3600000
        minimum: 3600
    _mcsman._tcp: !SRV 10 30 1337 mc
    _mcsftp._udp: !SRV
        priority: 10
        weight: 30
        port: 9645
        target: ftp.mc
    # Несколько TXT записей
    text: !TXT [ Several, TXT, records ]
    texts: !TXT # TXT запись с несколькими значениями
        text: [ One, TXT, record, with, multiple, values ]
    dev: # Поддомен
        : !A 23.45.0.1

finger-food.ru.:
    $ttl: 4444
    : !MX 5 mx
```

### Образ Docker

    docker run -d --name my-dns -v `pwd`/dns.yml:/dns.yml ktlo/net-lab2:dns

NTP Клиент
-----------------------------------------------------

### Использование

    rlwrap lab1-chat-client [хост] [порт] [начальная временная метка]

NTP оказался намного сложнее, чем я изначально подумал, но я сделал минимум. Время он спросить может.

### Образ Docker

    docker run -t --rm -v ktlo/net-lab2:ntp

Как построить?
-----------------------------------------------------

### Из исходного кода

Для сборки нам понадобятся:

```sh
apt install -y cmake build-essential clang git python3 python3-pip ninja-build \
  && python3 -m pip install --user meson
```

Сборка осуществляется с помощью [Meson](https://mesonbuild.com). Для сборки нужно выполнить следующую команду.

```sh
CXX=clang++ CC=clang meson -Dbuildtype=release -Doptimization=3 build && cd build && ninja
```

Неожиданно, но собрать это можно только с помощью clang. Я случайно написал код, который не работает на GCC, менять его у меня нет желания, слишком красиво получилось.

Для установки в операционную систему можно выполнить:

    ninja install

Чтобы удалить:

    ninja uninstall

### Сборка образа Docker

    docker build -t net-lab2-<?> -f Dockerfile.<?> .

Особенности реализации
-----------------------------------------------------

Программа совместима только с Linux операционными системами.

### DNS Сервер

Несмотря на то, что по сути может только выдавать "авторитетные" ответы (так как заправляет зонами, которые были прописаны в конфигурации), авторитетного ответа от него не дождётесь. Если надо будет, могу исправить, но чать кода придётся переписать.

### NTP Клиент

Почти ничего не может. Вообще по протоколу он должен опрашивать несколько серверов, иметь возможность авторизации, собирать статистику, а также выполнять особые действия при некоторых управляющих кодах. По сути этот клиент только демонстрирует один запрос и вычисление временного смещения.
